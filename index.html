<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sport Tracker Pro</title>
    <meta name="theme-color" content="#007AFF">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* –í—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            line-height: 1.6;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            position: relative;
        }

        .nav {
            display: flex;
            background: #007AFF;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-button {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .nav-button.active {
            background: rgba(255, 255, 255, 0.2);
        }

        .nav-button:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background: white;
            transition: all 0.3s;
            transform: translateX(-50%);
        }

        .nav-button.active:after {
            width: 80%;
        }

        .content {
            padding: 20px;
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .content.active {
            display: block;
        }

        .title {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-top: 20px;
            margin-bottom: 10px;
            color: #333;
        }

        .exercise-with-animation {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        .exercise-animation {
            width: 40px;
            height: 40px;
            margin-left: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .animation-chest { animation: chest-press 2s infinite ease-in-out; }
        .animation-back { animation: pull-up 2s infinite ease-in-out; }
        .animation-arms { animation: bicep-curl 2s infinite ease-in-out; }
        .animation-shoulders { animation: shoulder-press 2s infinite ease-in-out; }
        .animation-legs { animation: squat 2s infinite ease-in-out; }
        .animation-cardio { animation: running 1s infinite linear; }
        .animation-abs { animation: crunch 2s infinite ease-in-out; }

        @keyframes chest-press { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1) translateX(-2px); } }
        @keyframes pull-up { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-3px); } }
        @keyframes bicep-curl { 0%, 100% { transform: rotate(0deg); } 50% { transform: rotate(-15deg); } }
        @keyframes shoulder-press { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-2px); } }
        @keyframes squat { 0%, 100% { transform: translateY(0px) scale(1); } 50% { transform: translateY(2px) scale(0.95); } }
        @keyframes running { 0%, 100% { transform: translateX(0px); } 25% { transform: translateX(2px) translateY(-1px); } 75% { transform: translateX(-2px) translateY(1px); } }
        @keyframes crunch { 0%, 100% { transform: scaleY(1); } 50% { transform: scaleY(0.9); } }

        .grip-options, .single-leg-options, .chin-up-options {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .grip-option, .leg-option, .chin-up-option {
            flex: 1;
            min-width: 80px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #f9f9f9;
            cursor: pointer;
            text-align: center;
            font-size: 12px;
            transition: all 0.3s;
        }

        .grip-option.selected, .leg-option.selected, .chin-up-option.selected {
            background: #007AFF;
            color: white;
            border-color: #007AFF;
            transform: scale(1.05);
        }

        .bodyweight-section {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .bodyweight-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .bodyweight-checkbox:hover {
            background: #e9ecef;
        }

        .bodyweight-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .bodyweight-label {
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }

        .bodyweight-info {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            margin-left: 30px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .edit-button, .delete-button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .edit-button { background: #FF9500; color: white; }
        .delete-button { background: #FF3B30; color: white; }
        .edit-button:hover, .delete-button:hover { opacity: 0.9; transform: translateY(-1px); }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: scale(0.9) translateY(-20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .workout-set {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            transition: background 0.3s;
        }

        .workout-set:hover {
            background: #f9f9f9;
        }

        .close-modal {
            background: #007AFF;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin-top: 15px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .close-modal:hover {
            background: #0056CC;
            transform: translateY(-1px);
        }

        .calendar {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .calendar-nav {
            background: #007AFF;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .calendar-nav:hover {
            background: #0056CC;
            transform: scale(1.05);
        }

        .calendar-month {
            font-size: 18px;
            font-weight: 600;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-day {
            text-align: center;
            font-size: 12px;
            color: #666;
            padding: 5px;
            font-weight: 500;
        }

        .calendar-date {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            position: relative;
        }

        .calendar-date.has-workout {
            background: linear-gradient(135deg, #34C759, #30D158);
            color: white;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(52,199,89,0.3);
        }

        .calendar-date.today { 
            border: 2px solid #007AFF;
            background: #007AFF;
            color: white;
        }
        .calendar-date.other-month { color: #ccc; }
        .calendar-date.selected {
            border: 3px solid #007AFF !important;
            background: #007AFF !important;
            color: white !important;
            font-weight: bold;
            transform: scale(1.1);
        }

        .workout-history {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .history-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: all 0.3s;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .history-item:hover {
            background: #f8f9fa;
            transform: translateX(5px);
        }

        .history-exercise {
            font-weight: 500;
            margin-bottom: 5px;
            cursor: pointer;
            transition: color 0.3s;
            font-size: 16px;
        }

        .history-exercise:hover {
            color: #007AFF;
        }

        .history-details {
            font-size: 12px;
            color: #666;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #007AFF;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .groups-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .group-button {
            background: #e0e0e0;
            padding: 20px;
            border-radius: 15px;
            border: none;
            flex: 1 1 calc(50% - 10px);
            min-width: 140px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            font-weight: 500;
        }

        .group-button.selected {
            background: linear-gradient(135deg, #007AFF, #0056CC);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,122,255,0.3);
        }

        .group-button:hover:not(.selected) {
            background: #d0d0d0;
            transform: translateY(-2px);
        }

        .exercises-container {
            margin-bottom: 20px;
        }

        .exercise-button {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #ddd;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            text-align: left;
        }

        .exercise-button.selected {
            background: linear-gradient(135deg, #007AFF, #0056CC);
            color: white;
            border-color: #007AFF;
            transform: scale(1.02);
            box-shadow: 0 3px 10px rgba(0,122,255,0.2);
        }

        .exercise-button:hover:not(.selected) {
            background: #e8e8e8;
            transform: translateY(-2px);
        }

        .set-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            border: 1px solid #eee;
            gap: 10px;
            flex-wrap: wrap;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .set-container:hover {
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .set-number {
            font-size: 16px;
            font-weight: 500;
            min-width: 80px;
        }

        .set-inputs {
            display: flex;
            gap: 10px;
            flex: 1;
            min-width: 200px;
        }

        .weight-input, .reps-input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            width: 100%;
            transition: all 0.3s;
        }

        .weight-input:focus, .reps-input:focus {
            border-color: #007AFF;
            box-shadow: 0 0 0 2px rgba(0,122,255,0.2);
            outline: none;
        }

        .input-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .input-group { flex: 1; }

        .checkbox {
            width: 28px;
            height: 28px;
            border: 2px solid #007AFF;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink: 0;
            transition: all 0.3s;
        }

        .checkbox.completed { 
            background: #34C759; 
            border-color: #34C759;
        }
        .checkbox-text { color: white; font-weight: bold; font-size: 14px; }

        .delete-set-button {
            background: #FF3B30;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-left: 10px;
            flex-shrink: 0;
            transition: all 0.3s;
        }

        .delete-set-button:hover {
            background: #D70015;
            transform: scale(1.1);
        }

        .add-button, .save-button {
            padding: 15px;
            border-radius: 12px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .add-button { 
            background: linear-gradient(135deg, #34C759, #30D158);
            color: white;
        }
        .save-button { 
            background: linear-gradient(135deg, #007AFF, #0056CC);
            color: white;
        }
        .add-button:hover, .save-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .completed-set {
            background: #f8fff8;
            border-color: #34C759;
            box-shadow: 0 2px 8px rgba(52,199,89,0.2);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #34C759;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1001;
            transform: translateX(150%);
            transition: transform 0.3s ease-out;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #FF3B30;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007AFF;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 480px) {
            .container {
                max-width: 100%;
            }
            
            .nav-button {
                padding: 12px 8px;
                font-size: 12px;
            }
            
            .content {
                padding: 15px;
            }
            
            .set-inputs {
                flex-direction: column;
                min-width: 150px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="notification" id="notification"></div>

        <div class="modal" id="workoutModal">
            <div class="modal-content">
                <div class="modal-title" id="modalExerciseName"></div>
                <div class="workout-details" id="workoutDetails"></div>
                <button class="close-modal" onclick="app.closeWorkoutModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>

        <div class="nav">
            <!-- –ò–∑–º–µ–Ω–∏–ª–∏ –∏–∫–æ–Ω–∫—É —Å –¥–æ–º–∞ –Ω–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—å -->
            <button class="nav-button active" onclick="app.showTab('home')">üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Ç—Ä–µ–Ω–µ—Ä–æ–≤–æ–∫</button>
            <button class="nav-button" onclick="app.showTab('workout')">üí™ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</button>
            <button class="nav-button" onclick="app.showTab('analytics')">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
        </div>

        <div id="home" class="content active">
            <div class="title">–ú–æ–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</div>
            <div class="calendar">
                <div class="calendar-header">
                    <button class="calendar-nav" onclick="app.changeMonth(-1)">‚Üê</button>
                    <div class="calendar-month" id="currentMonth"></div>
                    <button class="calendar-nav" onclick="app.changeMonth(1)">‚Üí</button>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>
            <div class="workout-history">
                <div id="workoutHistory"></div>
            </div>
        </div>

        <div id="workout" class="content">
            <div class="title">–ù–æ–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</div>
            <div class="section-title">1. –í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É –º—ã—à—Ü:</div>
            <div class="groups-container" id="groupsContainer"></div>
            <div id="exercisesSection" style="display: none;">
                <div class="section-title" id="exercisesTitle">2. –í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ:</div>
                <div class="exercises-container" id="exercisesContainer"></div>
            </div>
            <div id="setsSection" style="display: none;">
                <div class="section-title" id="setsTitle">3. –ü–æ–¥—Ö–æ–¥—ã –¥–ª—è: <span id="selectedExerciseName"></span></div>
                
                <!-- –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–µ—Å –¥–ª—è –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π -->
                <div id="bodyweightSection" style="display: none;">
                    <div class="bodyweight-section">
                        <div class="bodyweight-checkbox" onclick="app.toggleBodyweight()">
                            <input type="checkbox" id="bodyweightCheckbox">
                            <span class="bodyweight-label">–¢–æ–ª—å–∫–æ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –≤–µ—Å–æ–º</span>
                        </div>
                        <div class="bodyweight-info">
                            –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–≥–¥–∞ –Ω–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤–µ—Å–∞, —Ç–æ–ª—å–∫–æ –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è —Å–≤–æ–∏–º —Ç–µ–ª–æ–º
                        </div>
                    </div>
                </div>

                <!-- –•–≤–∞—Ç –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π -->
                <div id="gripSection" style="display: none;">
                    <div class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ —Ö–≤–∞—Ç:</div>
                    <div class="grip-options" id="gripOptions"></div>
                </div>

                <!-- –û–¥–Ω–∞ –Ω–æ–≥–∞ –¥–ª—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –Ω–æ–≥ -->
                <div id="singleLegSection" style="display: none;">
                    <div class="section-title">–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:</div>
                    <div class="single-leg-options" id="singleLegOptions"></div>
                </div>

                <!-- –•–≤–∞—Ç –¥–ª—è —Ç—è–≥–∏ –∫ –ø–æ–¥–±–æ—Ä–æ–¥–∫—É -->
                <div id="chinUpSection" style="display: none;">
                    <div class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ —Ö–≤–∞—Ç:</div>
                    <div class="chin-up-options" id="chinUpOptions"></div>
                </div>

                <div id="setsContainer"></div>
                <button class="add-button" onclick="app.addSet()">+ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ö–æ–¥</button>
                <button class="save-button" onclick="app.saveWorkout()">
                    <span id="saveButtonText">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</span>
                </button>
            </div>
        </div>

        <div id="analytics" class="content">
            <div class="title">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalWorkouts">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="monthWorkouts">0</div>
                    <div class="stat-label">–ó–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalSets">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgWeight">0</div>
                    <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –≤–µ—Å (–∫–≥)</div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="muscleGroupChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="progressChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        const app = {
            // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –±–∞–∑–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π (—É–∂–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É)
            exercisesDatabase: {
                "–ì—Ä—É–¥—å": [
                    "–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π –ø–æ–¥ —É–≥–ª–æ–º",
                    "–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π –Ω–∞ –ø—Ä—è–º–æ–π —Å–∫–∞–º—å–µ",
                    "–ñ–∏–º –æ—Ç –≥—Ä—É–¥–∏ –≤ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ —Å–∏–¥—è",
                    "–ñ–∏–º —à—Ç–∞–Ω–≥–∏ –Ω–∞ –ø—Ä—è–º–æ–π —Å–∫–∞–º—å–µ", 
                    "–ñ–∏–º —à—Ç–∞–Ω–≥–∏ –≤ —Å–º–∏—Ç–µ",
                    "–ñ–∏–º —à—Ç–∞–Ω–≥–∏ –ø–æ–¥ —É–≥–ª–æ–º",
                    "–†–∞–∑–≤–æ–¥–∫–∞ –≥–∞–Ω—Ç–µ–ª–µ–π",
                    "–°–≤–µ–¥–µ–Ω–∏–µ —Ä—É–∫ –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ",
                    "–°–≤–µ–¥–µ–Ω–∏–µ —Ä—É–∫ –≤ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ '–ë–∞–±–æ—á–∫–∞'"
                ],
                "–°–ø–∏–Ω–∞": [
                    "–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —Ç—è–≥–∞ –≤ —Ä—ã—á–∞–∂–Ω–æ–º —Ç—Ä–µ–Ω–∞–∂—ë—Ä–µ",
                    "–ì–∏–ø–µ—Ä—ç–∫—Å—Ç–µ–Ω–∑–∏—è",
                    "–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è",
                    "–¢—è–≥–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ –±–ª–æ–∫–∞",
                    "–¢—è–≥–∞ –≤ —Ä—ã—á–∞–∂–Ω–æ–º —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ (–•–∞–º–º–µ—Ä)",
                    "–¢—è–≥–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –±–ª–æ–∫–∞ –∫ –ø–æ—è—Å—É",
                    "–¢—è–≥–∞ –±–ª–æ–∫–∞ –∫ –≥—Ä—É–¥–∏",
                    "–¢—è–≥–∞ —à—Ç–∞–Ω–≥–∏ –≤ –Ω–∞–∫–ª–æ–Ω–µ"
                ],
                "–†—É–∫–∏": [
                    "–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–≥–∏–±–∞–Ω–∏—è –Ω–∞ –±–∏—Ü–µ–ø—Å —Å–∏–¥—è",
                    "–ü–æ–¥—ä–µ–º –≥–∞–Ω—Ç–µ–ª–µ–π –Ω–∞ –±–∏—Ü–µ–ø—Å", 
                    "–ü–æ–¥—ä–µ–º —à—Ç–∞–Ω–≥–∏ –Ω–∞ –±–∏—Ü–µ–ø—Å",
                    "–†–∞–∑–≥–∏–±–∞–Ω–∏–µ —Ä—É–∫ –≤ –±–ª–æ—á–Ω–æ–º —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ",
                    "–†–∞–∑–≥–∏–±–∞–Ω–∏–µ —Ä—É–∫ —Å –≥–∞–Ω—Ç–µ–ª—å—é –≤ –Ω–∞–∫–ª–æ–Ω–µ",
                    "–†–∞–∑–≥–∏–±–∞–Ω–∏–µ —Ä—É–∫ —Å –≥–∞–Ω—Ç–µ–ª—å—é –∏–∑-–∑–∞ –≥–æ–ª–æ–≤—ã",
                    "–†–∞–∑–≥–∏–±–∞–Ω–∏–µ —Å –∫–∞–Ω–∞—Ç–æ–º –Ω–∞ —Ç—Ä–∏—Ü–µ–ø—Å",
                    "–°–≥–∏–±–∞–Ω–∏–µ ¬´–ú–æ–ª–æ—Ç¬ª (¬´–ú–æ–ª–æ—Ç–∫–∏¬ª)",
                    "–°–≥–∏–±–∞–Ω–∏–µ —Ä—É–∫ –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ",
                    "–°–≥–∏–±–∞–Ω–∏–µ —Ä—É–∫ –Ω–∞ –±–∏—Ü–µ–ø—Å –Ω–∞ –±–ª–æ–∫–µ",
                    "–°–≥–∏–±–∞–Ω–∏–µ —Ä—É–∫ –Ω–∞ —Å–∫–∞–º—å–µ –°–∫–æ—Ç—Ç–∞",
                    "–°–≥–∏–±–∞–Ω–∏–µ —Ä—É–∫ —Å –Ω–∏–∂–Ω–µ–≥–æ –±–ª–æ–∫–∞ —Å –∫–∞–Ω–∞—Ç–æ–º/—Ä—É–∫–æ—è—Ç—å—é",
                    "–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π –∂–∏–º",
                    "–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π –∂–∏–º —Å –≥–∞–Ω—Ç–µ–ª—è–º–∏ –ª–µ–∂–∞"
                ],
                "–ü–ª–µ—á–∏": [
                    "–ñ–∏–º –≥–∞–Ω—Ç–µ–ª–µ–π —Å–∏–¥—è", 
                    "–ñ–∏–º –Ω–∞–¥ –≥–æ–ª–æ–≤–æ–π –≤ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ",
                    "–ñ–∏–º —à—Ç–∞–Ω–≥–∏ —Å –≥—Ä—É–¥–∏",
                    "–ú–∞—Ö–∏ –≤ —Å—Ç–æ—Ä–æ–Ω—É –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ", 
                    "–ú–∞—Ö–∏ –≤ —Å—Ç–æ—Ä–æ–Ω—É –≤ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ",
                    "–ú–∞—Ö–∏ –≥–∞–Ω—Ç–µ–ª–µ–π –≤ —Å—Ç–æ—Ä–æ–Ω—ã",
                    "–ü–æ–¥—ä–µ–º –≥–∞–Ω—Ç–µ–ª–µ–π –ø–µ—Ä–µ–¥ —Å–æ–±–æ–π",
                    "–ü–æ–¥—ä–µ–º —Ä—É–∫–∏ –ø–µ—Ä–µ–¥ —Å–æ–±–æ–π –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ",
                    "–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ —Ä—É–∫ –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ –Ω–∞ –∑–∞–¥–Ω–∏–µ –¥–µ–ª—å—Ç—ã",
                    "–†–∞–∑–≤–µ–¥–µ–Ω–∏–µ —Ä—É–∫ –≤ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–µ –Ω–∞ –∑–∞–¥–Ω–∏–µ –¥–µ–ª—å—Ç—ã",
                    "–¢—è–≥–∞ –∫–∞–Ω–∞—Ç–æ–≤ –Ω–∞ –∑–∞–¥–Ω–∏–µ –¥–µ–ª—å—Ç—ã",
                    "–¢—è–≥–∞ –∫ –ø–æ–¥–±–æ—Ä–æ–¥–∫—É –≤ –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–µ",
                    "–¢—è–≥–∞ —à—Ç–∞–Ω–≥–∏ –∫ –ø–æ–¥–±–æ—Ä–æ–¥–∫—É"
                ],
                "–ù–æ–≥–∏": [
                    "–ñ–∏–º –Ω–æ–≥–∞–º–∏",
                    "–ñ–∏–º –Ω–æ–≥–∏ –ø–æ–¥ —É–≥–ª–æ–º",
                    "–ò–∫—Ä–æ–Ω–æ–∂–Ω—ã–µ –º—ã—à—Ü—ã",
                    "–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å–æ —à—Ç–∞–Ω–≥–æ–π",
                    "–†–∞–∑–≥–∏–±–∞–Ω–∏–µ –Ω–æ–≥ (–ø–æ –æ–¥–Ω–æ–π –Ω–æ–≥–µ)",
                    "–†–∞–∑–≥–∏–±–∞–Ω–∏–µ –Ω–æ–≥ —Å–∏–¥—è",
                    "–°–≥–∏–±–∞–Ω–∏–µ –Ω–æ–≥ (–ø–æ –æ–¥–Ω–æ–π –Ω–æ–≥–µ)",
                    "–°–≥–∏–±–∞–Ω–∏–µ –Ω–æ–≥ –ª–µ–∂–∞"
                ],
                "–ö–∞—Ä–¥–∏–æ": [
                    "–ë–µ–≥–æ–≤–∞—è –¥–æ—Ä–æ–∂–∫–∞", 
                    "–í–µ–ª–æ—Ç—Ä–µ–Ω–∞–∂–µ—Ä", 
                    "–®–∞–≥–∏ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ (–°—Ç–µ–ø-–∞–ø)",
                    "–≠–ª–ª–∏–ø—Å"
                ],
                "–ü—Ä–µ—Å—Å": [
                    "–ü–ª–∞–Ω–∫–∞",
                    "–ü–æ–¥—ä–µ–º –Ω–æ–≥ –≤ –≤–∏—Å–µ",
                    "–ü–æ–¥—ä–µ–º –Ω–æ–≥ –Ω–∞ —Å–∫–∞–º—å–µ (—Å–≤–µ—á–∫–∞)",
                    "–°–∫—Ä—É—á–∏–≤–∞–Ω–∏—è"
                ]
            },

            // –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —Å –≤—ã–±–æ—Ä–æ–º —Ö–≤–∞—Ç–∞
            exercisesWithGrip: [
                "–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å–æ —à—Ç–∞–Ω–≥–æ–π", 
                "–ñ–∏–º –Ω–æ–≥–∞–º–∏",
                "–¢—è–≥–∞ –±–ª–æ–∫–∞ –∫ –≥—Ä—É–¥–∏",
                "–¢—è–≥–∞ —à—Ç–∞–Ω–≥–∏ –∫ –ø–æ–¥–±–æ—Ä–æ–¥–∫—É"
            ],

            // –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –¥–ª—è –æ–¥–Ω–æ–π –Ω–æ–≥–∏
            singleLegExercises: [
                "–°–≥–∏–±–∞–Ω–∏–µ –Ω–æ–≥ (–ø–æ –æ–¥–Ω–æ–π –Ω–æ–≥–µ)",
                "–†–∞–∑–≥–∏–±–∞–Ω–∏–µ –Ω–æ–≥ (–ø–æ –æ–¥–Ω–æ–π –Ω–æ–≥–µ)"
            ],

            // –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –≤–µ—Å–æ–º
            bodyweightExercises: [
                "–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è"
            ],

            // –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –≥—Ä—É–ø–ø
            groupAnimations: {
                "–ì—Ä—É–¥—å": "animation-chest",
                "–°–ø–∏–Ω–∞": "animation-back", 
                "–†—É–∫–∏": "animation-arms",
                "–ü–ª–µ—á–∏": "animation-shoulders",
                "–ù–æ–≥–∏": "animation-legs",
                "–ö–∞—Ä–¥–∏–æ": "animation-cardio",
                "–ü—Ä–µ—Å—Å": "animation-abs"
            },

            // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            state: {
                selectedWorkoutDate: null,
                currentMonth: new Date().getMonth(),
                currentYear: new Date().getFullYear(),
                selectedGroup: null,
                selectedExercise: null,
                sets: [{ weight: '', reps: '', completed: false }],
                selectedGrip: null,
                singleLeg: null,
                chinUpGrip: null,
                bodyweight: false,
                editingWorkout: null
            },

            // –ö—ç—à –∏ –≥—Ä–∞—Ñ–∏–∫–∏
            cachedHistory: {},
            muscleGroupChart: null,
            progressChart: null,

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            async init() {
                try {
                    this.showNotification('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...', 'info');
                    this.cachedHistory = await this.getWorkoutHistory();
                    this.renderCalendar();
                    this.initWorkout();
                    await this.updateAnalytics();
                    this.hideNotification();
                } catch (error) {
                    this.showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏', 'error');
                    console.error('Init error:', error);
                }
            },

            // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            showNotification(message, type = 'info') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type === 'error' ? 'error' : ''}`;
                notification.classList.add('show');
                
                if (type !== 'info') {
                    setTimeout(() => this.hideNotification(), 3000);
                }
            },

            hideNotification() {
                const notification = document.getElementById('notification');
                notification.classList.remove('show');
            },

            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º
            async showTab(tabName) {
                document.querySelectorAll('.content').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
                
                document.getElementById(tabName).classList.add('active');
                event.target.classList.add('active');

                switch(tabName) {
                    case 'analytics':
                        await this.updateAnalytics();
                        break;
                    case 'home':
                        this.cachedHistory = await this.getWorkoutHistory();
                        this.renderCalendar();
                        break;
                    case 'workout':
                        this.initWorkout();
                        break;
                }
            },

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
            initWorkout() {
                this.renderGroups();
            },

            // –†–µ–Ω–¥–µ—Ä –≥—Ä—É–ø–ø –º—ã—à—Ü
            renderGroups() {
                const groupsContainer = document.getElementById('groupsContainer');
                groupsContainer.innerHTML = '';

                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –≥—Ä—É–ø–ø—ã –º—ã—à—Ü –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É
                const sortedGroups = Object.keys(this.exercisesDatabase).sort();

                sortedGroups.forEach(group => {
                    const button = document.createElement('button');
                    button.className = 'group-button';
                    button.innerHTML = `
                        <div class="group-button-text">${group}</div>
                    `;
                    button.onclick = () => this.selectGroup(group);
                    groupsContainer.appendChild(button);
                });
            },

            // –í—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã –º—ã—à—Ü
            selectGroup(group) {
                this.state.selectedGroup = group;
                this.state.selectedExercise = null;
                this.state.sets = [{ weight: '', reps: '', completed: false }];
                this.state.selectedGrip = null;
                this.state.singleLeg = null;
                this.state.chinUpGrip = null;
                this.state.bodyweight = false;
                this.state.editingWorkout = null;

                document.querySelectorAll('.group-button').forEach(btn => {
                    btn.classList.remove('selected');
                });
                event.target.classList.add('selected');

                this.renderExercises();
                document.getElementById('exercisesSection').style.display = 'block';
                document.getElementById('setsSection').style.display = 'none';
                document.getElementById('gripSection').style.display = 'none';
                document.getElementById('singleLegSection').style.display = 'none';
                document.getElementById('chinUpSection').style.display = 'none';
                document.getElementById('bodyweightSection').style.display = 'none';
                
                document.querySelector('.save-button').textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É';
            },

            // –†–µ–Ω–¥–µ—Ä —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π (—É–∂–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö)
            renderExercises() {
                const exercisesContainer = document.getElementById('exercisesContainer');
                const exercisesTitle = document.getElementById('exercisesTitle');

                exercisesTitle.textContent = `2. –í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–ª—è ${this.state.selectedGroup}:`;
                exercisesContainer.innerHTML = '';

                const animationClass = this.groupAnimations[this.state.selectedGroup];

                // –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —É–∂–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
                this.exercisesDatabase[this.state.selectedGroup].forEach(exercise => {
                    const button = document.createElement('button');
                    button.className = 'exercise-button';
                    button.innerHTML = `
                        <div class="exercise-with-animation">
                            <div class="exercise-name">${exercise}</div>
                            <div class="exercise-animation ${animationClass}">
                                ${this.getExerciseEmoji(this.state.selectedGroup)}
                            </div>
                        </div>
                    `;
                    button.onclick = () => this.selectExercise(exercise);
                    exercisesContainer.appendChild(button);
                });
            },

            // Emoji –¥–ª—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
            getExerciseEmoji(group) {
                const emojis = {
                    "–ì—Ä—É–¥—å": "üèãÔ∏è",
                    "–°–ø–∏–Ω–∞": "üí™", 
                    "–†—É–∫–∏": "üí™",
                    "–ü–ª–µ—á–∏": "‚¨ÜÔ∏è",
                    "–ù–æ–≥–∏": "ü¶µ",
                    "–ö–∞—Ä–¥–∏–æ": "üèÉ",
                    "–ü—Ä–µ—Å—Å": "üîÅ"
                };
                return emojis[group] || "üí™";
            },

            // –í—ã–±–æ—Ä —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
            selectExercise(exercise) {
                this.state.selectedExercise = exercise;

                document.querySelectorAll('.exercise-button').forEach(btn => {
                    btn.classList.remove('selected');
                });
                event.target.classList.add('selected');

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –æ–ø—Ü–∏–∏
                if (this.exercisesWithGrip.includes(exercise)) {
                    if (exercise === "–¢—è–≥–∞ –±–ª–æ–∫–∞ –∫ –≥—Ä—É–¥–∏") {
                        document.getElementById('gripSection').style.display = 'block';
                        this.renderGripOptions();
                    } else if (exercise === "–¢—è–≥–∞ —à—Ç–∞–Ω–≥–∏ –∫ –ø–æ–¥–±–æ—Ä–æ–¥–∫—É") {
                        document.getElementById('chinUpSection').style.display = 'block';
                        this.renderChinUpOptions();
                    } else {
                        document.getElementById('gripSection').style.display = 'block';
                        this.renderGripOptions();
                    }
                } else {
                    document.getElementById('gripSection').style.display = 'none';
                    this.state.selectedGrip = null;
                }

                if (this.singleLegExercises.includes(exercise)) {
                    document.getElementById('singleLegSection').style.display = 'block';
                    this.renderSingleLegOptions();
                } else {
                    document.getElementById('singleLegSection').style.display = 'none';
                    this.state.singleLeg = null;
                }

                if (this.bodyweightExercises.includes(exercise)) {
                    document.getElementById('bodyweightSection').style.display = 'block';
                    this.renderBodyweightOption();
                } else {
                    document.getElementById('bodyweightSection').style.display = 'none';
                    this.state.bodyweight = false;
                }

                this.renderSets();
                document.getElementById('setsSection').style.display = 'block';
            },

            // –û–ø—Ü–∏–∏ —Ö–≤–∞—Ç–∞
            renderGripOptions() {
                const gripOptions = document.getElementById('gripOptions');
                gripOptions.innerHTML = `
                    <div class="grip-option ${this.state.selectedGrip === 'narrow' ? 'selected' : ''}" onclick="app.selectGrip('narrow')">–£–∑–∫–∞—è</div>
                    <div class="grip-option ${this.state.selectedGrip === 'medium' ? 'selected' : ''}" onclick="app.selectGrip('medium')">–°—Ä–µ–¥–Ω—è—è</div>
                    <div class="grip-option ${this.state.selectedGrip === 'wide' ? 'selected' : ''}" onclick="app.selectGrip('wide')">–®–∏—Ä–æ–∫–∞—è</div>
                `;
            },

            // –û–ø—Ü–∏–∏ –¥–ª—è –æ–¥–Ω–æ–π –Ω–æ–≥–∏
            renderSingleLegOptions() {
                const singleLegOptions = document.getElementById('singleLegOptions');
                singleLegOptions.innerHTML = `
                    <div class="leg-option ${this.state.singleLeg === 'both' ? 'selected' : ''}" onclick="app.selectSingleLeg('both')">–û–±–µ –Ω–æ–≥–∏</div>
                    <div class="leg-option ${this.state.singleLeg === 'left' ? 'selected' : ''}" onclick="app.selectSingleLeg('left')">–õ–µ–≤–∞—è –Ω–æ–≥–∞</div>
                    <div class="leg-option ${this.state.singleLeg === 'right' ? 'selected' : ''}" onclick="app.selectSingleLeg('right')">–ü—Ä–∞–≤–∞—è –Ω–æ–≥–∞</div>
                `;
            },

            // –û–ø—Ü–∏–∏ –¥–ª—è —Ç—è–≥–∏ –∫ –ø–æ–¥–±–æ—Ä–æ–¥–∫—É
            renderChinUpOptions() {
                const chinUpOptions = document.getElementById('chinUpOptions');
                chinUpOptions.innerHTML = `
                    <div class="chin-up-option ${this.state.chinUpGrip === 'narrow' ? 'selected' : ''}" onclick="app.selectChinUpGrip('narrow')">–£–∑–∫–∏–π —Ö–≤–∞—Ç</div>
                    <div class="chin-up-option ${this.state.chinUpGrip === 'wide' ? 'selected' : ''}" onclick="app.selectChinUpGrip('wide')">–®–∏—Ä–æ–∫–∏–π —Ö–≤–∞—Ç</div>
                `;
            },

            // –û–ø—Ü–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤–µ—Å–∞
            renderBodyweightOption() {
                const checkbox = document.getElementById('bodyweightCheckbox');
                if (checkbox) {
                    checkbox.checked = this.state.bodyweight;
                }
            },

            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤–µ—Å–∞
            toggleBodyweight() {
                this.state.bodyweight = !this.state.bodyweight;
                const checkbox = document.getElementById('bodyweightCheckbox');
                if (checkbox) {
                    checkbox.checked = this.state.bodyweight;
                }
                this.renderSets();
            },

            // –í—ã–±–æ—Ä —Ö–≤–∞—Ç–∞
            selectGrip(grip) {
                this.state.selectedGrip = grip;
                this.renderGripOptions();
            },

            // –í—ã–±–æ—Ä –¥–ª—è –æ–¥–Ω–æ–π –Ω–æ–≥–∏
            selectSingleLeg(option) {
                this.state.singleLeg = option;
                this.renderSingleLegOptions();
            },

            // –í—ã–±–æ—Ä —Ö–≤–∞—Ç–∞ –¥–ª—è —Ç—è–≥–∏ –∫ –ø–æ–¥–±–æ—Ä–æ–¥–∫—É
            selectChinUpGrip(grip) {
                this.state.chinUpGrip = grip;
                this.renderChinUpOptions();
            },

            // –¢–µ–∫—Å—Ç –¥–ª—è —Ö–≤–∞—Ç–∞
            getGripText(grip) {
                const gripTexts = {
                    'narrow': '–£–∑–∫–∞—è',
                    'medium': '–°—Ä–µ–¥–Ω—è—è', 
                    'wide': '–®–∏—Ä–æ–∫–∞—è'
                };
                return gripTexts[grip] || '';
            },

            // –¢–µ–∫—Å—Ç –¥–ª—è –æ–¥–Ω–æ–π –Ω–æ–≥–∏
            getSingleLegText(option) {
                const legTexts = {
                    'both': '–û–±–µ –Ω–æ–≥–∏',
                    'left': '–õ–µ–≤–∞—è –Ω–æ–≥–∞',
                    'right': '–ü—Ä–∞–≤–∞—è –Ω–æ–≥–∞'
                };
                return legTexts[option] || '';
            },

            // –¢–µ–∫—Å—Ç –¥–ª—è —Ö–≤–∞—Ç–∞ –ø–æ–¥–±–æ—Ä–æ–¥–∫–∞
            getChinUpGripText(grip) {
                const gripTexts = {
                    'narrow': '–£–∑–∫–∏–π —Ö–≤–∞—Ç',
                    'wide': '–®–∏—Ä–æ–∫–∏–π —Ö–≤–∞—Ç'
                };
                return gripTexts[grip] || '';
            },

            // –†–µ–Ω–¥–µ—Ä –ø–æ–¥—Ö–æ–¥–æ–≤
            renderSets() {
                const setsContainer = document.getElementById('setsContainer');
                const selectedExerciseName = document.getElementById('selectedExerciseName');

                selectedExerciseName.textContent = this.state.selectedExercise;
                setsContainer.innerHTML = '';

                this.state.sets.forEach((set, index) => {
                    const setElement = document.createElement('div');
                    setElement.className = `set-container ${set.completed ? 'completed-set' : ''}`;
                    
                    // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–µ—Å, —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –≤–µ—Å–∞
                    const weightInput = this.state.bodyweight ? 
                        `<div class="input-group">
                            <div class="input-label">–í–µ—Å (–∫–≥)</div>
                            <input 
                                type="number" 
                                class="weight-input" 
                                placeholder="0" 
                                value="0"
                                disabled
                                style="background: #f5f5f5; color: #999;"
                            >
                        </div>` :
                        `<div class="input-group">
                            <div class="input-label">–í–µ—Å (–∫–≥)</div>
                            <input 
                                type="number" 
                                class="weight-input" 
                                placeholder="0" 
                                value="${set.weight}"
                                onchange="app.updateSet(${index}, 'weight', this.value)"
                                min="0"
                                step="0.5"
                            >
                        </div>`;

                    setElement.innerHTML = `
                        <div class="set-number">–ü–æ–¥—Ö–æ–¥ ${index + 1}</div>
                        <div class="set-inputs">
                            ${weightInput}
                            <div class="input-group">
                                <div class="input-label">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</div>
                                <input 
                                    type="number" 
                                    class="reps-input" 
                                    placeholder="0" 
                                    value="${set.reps}"
                                    onchange="app.updateSet(${index}, 'reps', this.value)"
                                    min="0"
                                >
                            </div>
                        </div>
                        <div class="checkbox ${set.completed ? 'completed' : ''}" onclick="app.toggleSet(${index})">
                            <div class="checkbox-text">${set.completed ? '‚úì' : ''}</div>
                        </div>
                        ${this.state.sets.length > 1 ? `
                            <button class="delete-set-button" onclick="app.deleteSet(${index})" title="–£–¥–∞–ª–∏—Ç—å –ø–æ–¥—Ö–æ–¥">
                                üóëÔ∏è
                            </button>
                        ` : ''}
                    `;
                    setsContainer.appendChild(setElement);
                });
            },

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–∞
            updateSet(index, field, value) {
                // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–µ—Å, –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ –≤–µ—Å–∞
                if (field === 'weight' && this.state.bodyweight) {
                    return;
                }
                this.state.sets[index][field] = value;
            },

            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–¥—Ö–æ–¥–∞
            toggleSet(index) {
                this.state.sets[index].completed = !this.state.sets[index].completed;
                this.renderSets();
            },

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–∞
            addSet() {
                this.state.sets.push({ weight: '', reps: '', completed: false });
                this.renderSets();
            },

            // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–∞
            deleteSet(index) {
                if (this.state.sets.length > 1) {
                    this.state.sets.splice(index, 1);
                    this.renderSets();
                }
            },

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
            async saveWorkout() {
                try {
                    const completedSets = this.state.sets.filter(set => set.completed);
                    if (completedSets.length === 0) {
                        this.showNotification('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥!', 'error');
                        return;
                    }

                    if (!this.state.selectedExercise || !this.state.selectedGroup) {
                        this.showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –∏ –≥—Ä—É–ø–ø—É –º—ã—à—Ü!', 'error');
                        return;
                    }

                    const dateString = this.state.selectedWorkoutDate || this.formatDate(new Date());

                    const workout = {
                        exercise: this.state.selectedExercise,
                        muscleGroup: this.state.selectedGroup,
                        sets: this.state.sets,
                        date: dateString
                    };

                    // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                    if (this.state.selectedGrip) {
                        workout.grip = this.state.selectedGrip;
                    }
                    if (this.state.singleLeg) {
                        workout.singleLeg = this.state.singleLeg;
                    }
                    if (this.state.chinUpGrip) {
                        workout.chinUpGrip = this.state.chinUpGrip;
                    }
                    if (this.state.bodyweight) {
                        workout.bodyweight = true;
                        // –î–ª—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –≤–µ—Å–æ–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–µ—Å = 0
                        workout.sets.forEach(set => {
                            if (set.completed) {
                                set.weight = '0';
                            }
                        });
                    }

                    this.showNotification('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...', 'info');

                    if (this.state.editingWorkout) {
                        await this.updateWorkoutInHistory(this.state.editingWorkout.date, this.state.editingWorkout.index, workout);
                        this.showNotification(`–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ "${this.state.selectedExercise}" –æ–±–Ω–æ–≤–ª–µ–Ω–∞!`);
                    } else {
                        await this.saveWorkoutToHistory(workout);
                        this.showNotification(`–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ "${this.state.selectedExercise}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!`);
                    }

                    this.resetWorkoutState();
                    this.cachedHistory = await this.getWorkoutHistory();
                    this.renderCalendar();
                    await this.updateAnalytics();
                    
                    setTimeout(() => this.showTab('home'), 1000);
                    
                } catch (error) {
                    this.showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
                    console.error('Save error:', error);
                }
            },

            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
            resetWorkoutState() {
                this.state.selectedWorkoutDate = null;
                this.state.selectedGroup = null;
                this.state.selectedExercise = null;
                this.state.sets = [{ weight: '', reps: '', completed: false }];
                this.state.selectedGrip = null;
                this.state.singleLeg = null;
                this.state.chinUpGrip = null;
                this.state.bodyweight = false;
                this.state.editingWorkout = null;

                document.querySelectorAll('.group-button, .exercise-button').forEach(btn => {
                    btn.classList.remove('selected');
                });
                document.getElementById('exercisesSection').style.display = 'none';
                document.getElementById('setsSection').style.display = 'none';
                document.getElementById('gripSection').style.display = 'none';
                document.getElementById('singleLegSection').style.display = 'none';
                document.getElementById('chinUpSection').style.display = 'none';
                document.getElementById('bodyweightSection').style.display = 'none';
                
                document.querySelector('.save-button').textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É';
            },

            // –ö–∞–ª–µ–Ω–¥–∞—Ä—å
            renderCalendar() {
                const monthNames = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
                    '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];

                document.getElementById('currentMonth').textContent = `${monthNames[this.state.currentMonth]} ${this.state.currentYear}`;

                const firstDay = new Date(this.state.currentYear, this.state.currentMonth, 1);
                const startDate = new Date(firstDay);
                const firstDayOfWeek = firstDay.getDay() || 7;
                startDate.setDate(startDate.getDate() - (firstDayOfWeek - 1));

                const calendarGrid = document.getElementById('calendarGrid');
                calendarGrid.innerHTML = '';

                ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'].forEach(day => {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    dayElement.textContent = day;
                    calendarGrid.appendChild(dayElement);
                });

                const today = new Date();
                const workoutHistory = this.cachedHistory;

                for (let i = 0; i < 42; i++) {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + i);

                    const dateElement = document.createElement('div');
                    dateElement.className = 'calendar-date';

                    const dateString = this.formatDate(date);
                    const hasWorkout = workoutHistory[dateString]?.length > 0;
                    const isToday = date.toDateString() === today.toDateString();
                    const isCurrentMonth = date.getMonth() === this.state.currentMonth;

                    if (!isCurrentMonth) dateElement.classList.add('other-month');
                    if (hasWorkout) dateElement.classList.add('has-workout');
                    if (isToday) dateElement.classList.add('today');

                    dateElement.textContent = date.getDate();
                    dateElement.onclick = () => this.showWorkoutHistory(dateString);
                    calendarGrid.appendChild(dateElement);
                }

                this.updateWorkoutHistory();
            },

            changeMonth(direction) {
                this.state.currentMonth += direction;
                if (this.state.currentMonth < 0) {
                    this.state.currentMonth = 11;
                    this.state.currentYear--;
                } else if (this.state.currentMonth > 11) {
                    this.state.currentMonth = 0;
                    this.state.currentYear++;
                }
                this.renderCalendar();
            },

            showWorkoutHistory(dateString) {
                this.state.selectedWorkoutDate = dateString;

                document.querySelectorAll('.calendar-date').forEach(date => date.classList.remove('selected'));
                event.target.classList.add('selected');

                const workoutHistory = this.cachedHistory;
                const workouts = workoutHistory[dateString];
                const workoutHistoryElement = document.getElementById('workoutHistory');

                if (workouts?.length > 0) {
                    let historyHTML = `
                        <div class="section-title">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∑–∞ ${dateString}:</div>
                        <button class="add-button" onclick="app.addWorkoutToDate('${dateString}')" style="margin-bottom: 15px;">
                            + –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –Ω–∞ —ç—Ç—É –¥–∞—Ç—É
                        </button>
                    `;
                    workouts.forEach((workout, index) => {
                        let details = [];
                        if (workout.grip) details.push(this.getGripText(workout.grip));
                        if (workout.singleLeg) details.push(this.getSingleLegText(workout.singleLeg));
                        if (workout.chinUpGrip) details.push(this.getChinUpGripText(workout.chinUpGrip));
                        if (workout.bodyweight) details.push('–°–≤–æ–π –≤–µ—Å');
                        
                        const detailsText = details.length > 0 ? ` (${details.join(', ')})` : '';
                        
                        historyHTML += `
                            <div class="history-item">
                                <div class="history-exercise" onclick="app.viewWorkoutDetails('${dateString}', ${index})">
                                    ${workout.exercise}${detailsText}
                                </div>
                                <div class="history-details">
                                    –ü–æ–¥—Ö–æ–¥–æ–≤: ${workout.sets.length} | –í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${workout.sets.filter(s => s.completed).length}
                                    ${workout.bodyweight ? ' | –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–µ—Å' : ''}
                                </div>
                                <div class="action-buttons">
                                    <button class="edit-button" onclick="app.editWorkout('${dateString}', ${index})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                    <button class="delete-button" onclick="app.deleteWorkout('${dateString}', ${index})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                                </div>
                            </div>
                        `;
                    });
                    workoutHistoryElement.innerHTML = historyHTML;
                } else {
                    workoutHistoryElement.innerHTML = `
                        <div class="section-title">–ù–∞ ${dateString} —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –Ω–µ—Ç</div>
                        <button class="add-button" onclick="app.addWorkoutToDate('${dateString}')">
                            + –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –Ω–∞ —ç—Ç—É –¥–∞—Ç—É
                        </button>
                    `;
                }
            },

            updateWorkoutHistory() {
                const workoutHistoryElement = document.getElementById('workoutHistory');
                if (!workoutHistoryElement) return;

                const workoutHistory = this.cachedHistory;
                const recentWorkouts = Object.entries(workoutHistory)
                    .sort((a, b) => {
                        const [dayA, monthA, yearA] = a[0].split('.');
                        const [dayB, monthB, yearB] = b[0].split('.');
                        const dateA = new Date(yearA, monthA - 1, dayA);
                        const dateB = new Date(yearB, monthB - 1, dayB);
                        return dateB - dateA;
                    })
                    .slice(0, 5);

                if (recentWorkouts.length > 0) {
                    let historyHTML = '<div class="section-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏:</div>';
                    recentWorkouts.forEach(([date, workouts]) => {
                        workouts.forEach((workout, index) => {
                            let details = [];
                            if (workout.grip) details.push(this.getGripText(workout.grip));
                            if (workout.singleLeg) details.push(this.getSingleLegText(workout.singleLeg));
                            if (workout.chinUpGrip) details.push(this.getChinUpGripText(workout.chinUpGrip));
                            if (workout.bodyweight) details.push('–°–≤–æ–π –≤–µ—Å');
                            
                            const detailsText = details.length > 0 ? ` (${details.join(', ')})` : '';
                            
                            historyHTML += `
                                <div class="history-item">
                                    <div class="history-exercise" onclick="app.viewWorkoutDetails('${date}', ${index})">
                                        ${workout.exercise}${detailsText}
                                    </div>
                                    <div class="history-details">${date} | –ü–æ–¥—Ö–æ–¥–æ–≤: ${workout.sets.length}${workout.bodyweight ? ' | –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–µ—Å' : ''}</div>
                                    <div class="action-buttons">
                                        <button class="edit-button" onclick="app.editWorkout('${date}', ${index})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                        <button class="delete-button" onclick="app.deleteWorkout('${date}', ${index})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                                    </div>
                                </div>
                            `;
                        });
                    });
                    workoutHistoryElement.innerHTML = historyHTML;
                } else {
                    workoutHistoryElement.innerHTML = '<div class="section-title">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</div>';
                }
            },

            addWorkoutToDate(dateString) {
                this.resetWorkoutState();
                this.state.selectedWorkoutDate = dateString;
                this.showTab('workout');
                this.showNotification(`–î–æ–±–∞–≤–ª—è–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –Ω–∞ ${dateString}`);
            },

            viewWorkoutDetails(dateString, workoutIndex) {
                const workoutHistory = this.cachedHistory;
                if (!workoutHistory[dateString]?.[workoutIndex]) {
                    this.showNotification('–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                    return;
                }
                
                const workout = workoutHistory[dateString][workoutIndex];

                let details = [];
                if (workout.grip) details.push(this.getGripText(workout.grip));
                if (workout.singleLeg) details.push(this.getSingleLegText(workout.singleLeg));
                if (workout.chinUpGrip) details.push(this.getChinUpGripText(workout.chinUpGrip));
                if (workout.bodyweight) details.push('–°–≤–æ–π –≤–µ—Å');
                
                const detailsText = details.length > 0 ? ` (${details.join(', ')})` : '';

                document.getElementById('modalExerciseName').textContent = `${workout.exercise}${detailsText}`;

                let detailsHTML = '<div class="workout-details">';
                workout.sets.forEach((set, index) => {
                    if (set.completed) {
                        const weightDisplay = workout.bodyweight ? '–°–≤–æ–π –≤–µ—Å' : `${set.weight} –∫–≥`;
                        detailsHTML += `
                            <div class="workout-set">
                                <div>–ü–æ–¥—Ö–æ–¥ ${index + 1}</div>
                                <div>${weightDisplay} √ó ${set.reps} –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π</div>
                            </div>
                        `;
                    }
                });
                detailsHTML += '</div>';

                document.getElementById('workoutDetails').innerHTML = detailsHTML;
                document.getElementById('workoutModal').style.display = 'flex';
            },

            closeWorkoutModal() {
                document.getElementById('workoutModal').style.display = 'none';
            },

            editWorkout(dateString, workoutIndex) {
                const workoutHistory = this.cachedHistory;
                if (!workoutHistory[dateString]?.[workoutIndex]) {
                    this.showNotification('–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                    return;
                }
                
                const workout = workoutHistory[dateString][workoutIndex];

                this.state.selectedGroup = workout.muscleGroup;
                this.state.selectedExercise = workout.exercise;
                this.state.sets = workout.sets;
                this.state.selectedGrip = workout.grip || null;
                this.state.singleLeg = workout.singleLeg || null;
                this.state.chinUpGrip = workout.chinUpGrip || null;
                this.state.bodyweight = workout.bodyweight || false;
                this.state.editingWorkout = { date: dateString, index: workoutIndex };

                this.showTab('workout');

                setTimeout(() => {
                    document.querySelectorAll('.group-button').forEach(btn => {
                        btn.classList.remove('selected');
                        if (btn.textContent.includes(this.state.selectedGroup)) {
                            btn.classList.add('selected');
                        }
                    });

                    this.renderExercises();
                    document.getElementById('exercisesSection').style.display = 'block';

                    setTimeout(() => {
                        document.querySelectorAll('.exercise-button').forEach(btn => {
                            btn.classList.remove('selected');
                            if (btn.textContent.includes(this.state.selectedExercise)) {
                                btn.classList.add('selected');
                            }
                        });

                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –æ–ø—Ü–∏–∏
                        if (this.exercisesWithGrip.includes(this.state.selectedExercise)) {
                            if (this.state.selectedExercise === "–¢—è–≥–∞ –±–ª–æ–∫–∞ –∫ –≥—Ä—É–¥–∏") {
                                document.getElementById('gripSection').style.display = 'block';
                                this.renderGripOptions();
                            } else if (this.state.selectedExercise === "–¢—è–≥–∞ —à—Ç–∞–Ω–≥–∏ –∫ –ø–æ–¥–±–æ—Ä–æ–¥–∫—É") {
                                document.getElementById('chinUpSection').style.display = 'block';
                                this.renderChinUpOptions();
                            } else {
                                document.getElementById('gripSection').style.display = 'block';
                                this.renderGripOptions();
                            }
                        }

                        if (this.singleLegExercises.includes(this.state.selectedExercise)) {
                            document.getElementById('singleLegSection').style.display = 'block';
                            this.renderSingleLegOptions();
                        }

                        if (this.bodyweightExercises.includes(this.state.selectedExercise)) {
                            document.getElementById('bodyweightSection').style.display = 'block';
                            this.renderBodyweightOption();
                        }

                        this.renderSets();
                        document.getElementById('setsSection').style.display = 'block';
                        document.querySelector('.save-button').textContent = '–û–±–Ω–æ–≤–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É';
                    }, 100);
                }, 100);
            },

            async deleteWorkout(dateString, workoutIndex) {
                if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É?')) return;

                try {
                    const workoutHistory = await this.getWorkoutHistory();
                    
                    if (workoutHistory[dateString] && workoutHistory[dateString][workoutIndex]) {
                        workoutHistory[dateString].splice(workoutIndex, 1);

                        if (workoutHistory[dateString].length === 0) {
                            delete workoutHistory[dateString];
                        }

                        await window.storage.set('workoutHistory', JSON.stringify(workoutHistory), false);
                        this.cachedHistory = workoutHistory;
                        this.updateWorkoutHistory();
                        this.renderCalendar();
                        await this.updateAnalytics();
                        
                        this.showNotification('–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —É–¥–∞–ª–µ–Ω–∞!');
                    } else {
                        this.showNotification('–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);
                    this.showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É', 'error');
                }
            },

            // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
            async updateAnalytics() {
                this.cachedHistory = await this.getWorkoutHistory();
                const allWorkouts = this.getAllWorkouts();

                document.getElementById('totalWorkouts').textContent = allWorkouts.length;

                const thisMonth = new Date().getMonth();
                const monthWorkouts = allWorkouts.filter(workout => {
                    const [day, month, year] = workout.date.split('.');
                    const workoutDate = new Date(year, month - 1, day);
                    return workoutDate.getMonth() === thisMonth;
                });
                document.getElementById('monthWorkouts').textContent = monthWorkouts.length;

                // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—Ö–æ–¥–æ–≤
                const totalSets = allWorkouts.reduce((sum, workout) => sum + workout.sets.filter(set => set.completed).length, 0);
                document.getElementById('totalSets').textContent = totalSets;

                // –°—Ä–µ–¥–Ω–∏–π –≤–µ—Å (–∏—Å–∫–ª—é—á–∞—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –≤–µ—Å–æ–º)
                const allWeights = [];
                allWorkouts.forEach(workout => {
                    if (!workout.bodyweight) {
                        workout.sets.filter(set => set.completed && set.weight && parseFloat(set.weight) > 0).forEach(set => {
                            allWeights.push(parseFloat(set.weight));
                        });
                    }
                });
                const avgWeight = allWeights.length > 0 ? 
                    (allWeights.reduce((a, b) => a + b, 0) / allWeights.length).toFixed(1) : '0';
                document.getElementById('avgWeight').textContent = avgWeight;

                this.updateMuscleGroupChart(allWorkouts);
                this.updateProgressChart(allWorkouts);
            },

            updateMuscleGroupChart(workouts) {
                const muscleGroups = {};

                workouts.forEach(workout => {
                    const group = workout.muscleGroup;
                    muscleGroups[group] = (muscleGroups[group] || 0) + 1;
                });

                const ctx = document.getElementById('muscleGroupChart').getContext('2d');

                if (this.muscleGroupChart) {
                    this.muscleGroupChart.destroy();
                }

                const colors = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#FF6384'];

                this.muscleGroupChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(muscleGroups),
                        datasets: [{
                            data: Object.values(muscleGroups),
                            backgroundColor: colors,
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'bottom' },
                            title: {
                                display: true,
                                text: '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≥—Ä—É–ø–ø–∞–º –º—ã—à—Ü'
                            }
                        }
                    }
                });
            },

            updateProgressChart(workouts) {
                const ctx = document.getElementById('progressChart').getContext('2d');
                if (this.progressChart) {
                    this.progressChart.destroy();
                }

                const lastWorkouts = workouts.slice(-10).reverse();
                const labels = lastWorkouts.map((_, i) => `–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ ${i + 1}`);
                const data = lastWorkouts.map(workout => {
                    const completedSets = workout.sets.filter(set => set.completed);
                    return completedSets.reduce((sum, set) => sum + (parseFloat(set.weight) || 0), 0);
                });

                this.progressChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: '–°—É–º–º–∞—Ä–Ω—ã–π –≤–µ—Å (–∫–≥)',
                            data: data,
                            borderColor: '#007AFF',
                            backgroundColor: 'rgba(0, 122, 255, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: '–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º'
                            }
                        },
                        scales: {
                            y: { 
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: '–°—É–º–º–∞—Ä–Ω—ã–π –≤–µ—Å (–∫–≥)'
                                }
                            }
                        }
                    }
                });
            },

            // –†–∞–±–æ—Ç–∞ —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º
            async getWorkoutHistory() {
                try {
                    // –î–ª—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                    if (window.storage) {
                        const result = await window.storage.get('workoutHistory', false);
                        if (!result || !result.value) return {};
                        
                        const parsedHistory = JSON.parse(result.value);
                        const convertedHistory = {};

                        Object.keys(parsedHistory).forEach(oldDateString => {
                            let newDateString;

                            if (oldDateString.includes('-')) {
                                const [year, month, day] = oldDateString.split('-');
                                newDateString = `${day.padStart(2, '0')}.${month.padStart(2, '0')}.${year}`;
                            } else {
                                newDateString = oldDateString;
                            }

                            convertedHistory[newDateString] = parsedHistory[oldDateString];
                        });

                        return convertedHistory;
                    } else {
                        // –î–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
                        const history = localStorage.getItem('workoutHistory');
                        return history ? JSON.parse(history) : {};
                    }
                } catch (error) {
                    console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ');
                    return {};
                }
            },

            getAllWorkouts() {
                const history = this.cachedHistory || {};
                const allWorkouts = [];

                Object.values(history).forEach(workouts => {
                    allWorkouts.push(...workouts);
                });

                return allWorkouts.sort((a, b) => {
                    const [dayA, monthA, yearA] = a.date.split('.');
                    const [dayB, monthB, yearB] = b.date.split('.');
                    return new Date(yearA, monthA - 1, dayA) - new Date(yearB, monthB - 1, dayB);
                });
            },

            async saveWorkoutToHistory(workout) {
                try {
                    const history = await this.getWorkoutHistory();
                    const dateString = workout.date;

                    if (!history[dateString]) {
                        history[dateString] = [];
                    }

                    history[dateString].push(workout);
                    
                    if (window.storage) {
                        await window.storage.set('workoutHistory', JSON.stringify(history), false);
                    } else {
                        localStorage.setItem('workoutHistory', JSON.stringify(history));
                    }
                    
                    this.cachedHistory = history;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                    throw error;
                }
            },

            async updateWorkoutInHistory(dateString, workoutIndex, updatedWorkout) {
                try {
                    const history = await this.getWorkoutHistory();
                    
                    if (history[dateString] && history[dateString][workoutIndex]) {
                        history[dateString][workoutIndex] = updatedWorkout;
                        
                        if (window.storage) {
                            await window.storage.set('workoutHistory', JSON.stringify(history), false);
                        } else {
                            localStorage.setItem('workoutHistory', JSON.stringify(history));
                        }
                        
                        this.cachedHistory = history;
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', error);
                    throw error;
                }
            },

            formatDate(date) {
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const year = date.getFullYear();
                return `${day}.${month}.${year}`;
            }
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        if (window.cordova || window.Capacitor) {
            document.addEventListener('deviceready', () => {
                app.init();
            }, false);
        } else {
            document.addEventListener('DOMContentLoaded', () => app.init());
        }
    </script>
</body>
</html>